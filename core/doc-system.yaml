# Living Documentation System Schema v1.0
# This schema drives ALL automation - no hardcoding needed
# Language-agnostic configuration - override with project-config.yaml

version: "1.0"
auto_discovery: true

# =============================================================================
# WHY THIS MATTERS
# By mapping code to explicit bug patterns, invariants, and decisions,
# AI agents receive the correct architectural context upfront. This enables
# accurate analysis and fixes on first contact with large codebases, cutting
# debugging and review time from days to hours without repeated prompting.
# =============================================================================

# =============================================================================
# DOCUMENT CATEGORIES - Add new categories here, system auto-discovers
# =============================================================================
categories:
  bugs:
    name: "Bug Tracking"
    files:
      - "BUG_TRACKER.md"
    # Configure bug tracking in project-config.yaml

  patterns:
    name: "Bug Patterns"
    files:
      - "BUG_PATTERNS.md"
    subcategories: []
    # EXAMPLES - customize for your project:
    # - name: "api"          # Web services
    # - name: "database"     # Data layer
    # - name: "auth"         # Security/authentication
    # - name: "ui"           # User interface
    # - name: "networking"   # Network/realtime

  invariants:
    name: "Safety Invariants"
    files:
      - "INVARIANTS.md"
    subcategories: []
    # EXAMPLES - common invariant categories:
    # - name: "thread_safety"   # Concurrency rules
    # - name: "data_integrity"  # Database/state rules
    # - name: "security"        # Auth/access rules
    # - name: "performance"     # Resource limits

  golden_paths:
    name: "Golden Paths"
    files:
      - "GOLDEN_PATHS.md"
    # Best practices - no subcategories needed by default

  decisions:
    name: "Architecture Decisions"
    files:
      - "DECISIONS.md"
    subcategories:
      - name: "accepted"
        pattern: '\*\*Status:\*\*.*Accepted'
      - name: "deprecated"
        pattern: '\*\*Status:\*\*.*Deprecated'
      - name: "proposed"
        pattern: '\*\*Status:\*\*.*Proposed'

# =============================================================================
# FILE TIERING RULES - Auto-tier based on patterns
# Configure patterns for your language/framework in project-config.yaml
# =============================================================================
tiering:
  rules:
    tier_a:
      name: "Critical"
      enforcement: "blocking"
      patterns:
        # EXAMPLES - customize for your project:
        # Python: "**/config.py", "**/settings.py", "**/database/*.py"
        # JavaScript: "**/config/*.js", "**/*Manager.js", "**/server.js"
        # Go: "**/*config.go", "**/*manager.go", "**/main.go"
        # Rust: "**/config.rs", "**/lib.rs", "**/main.rs"
        - "**/*Config.{{EXT}}"
        - "**/*Manager.{{EXT}}"
        - "**/config/**/*.{{EXT}}"
        - "**/core/**/*.{{EXT}}"
      keywords:
        - "CRITICAL"
        - "INVARIANT"
        - "TIER A"
        - "SAFETY"
        - "SECURITY"
      min_references: 10  # If referenced by 10+ files, auto-tier A

    tier_b:
      name: "Important"
      enforcement: "warning"
      patterns:
        - "**/api/**/*.{{EXT}}"
        - "**/services/**/*.{{EXT}}"
        - "**/models/**/*.{{EXT}}"
        - "**/*Service.{{EXT}}"
      keywords:
        - "IMPORTANT"
        - "SAFETY"
      min_references: 5

    tier_c:
      name: "Standard"
      enforcement: "advisory"
      patterns:
        - "**/ui/**/*.{{EXT}}"
        - "**/utils/**/*.{{EXT}}"
        - "**/helpers/**/*.{{EXT}}"
      default: true  # Files not matching other rules

    tier_d:
      name: "Legacy/Deprecated"
      enforcement: "none"
      patterns:
        - "**/deprecated/**/*.{{EXT}}"
        - "**/legacy/**/*.{{EXT}}"
      keywords:
        - "[Obsolete]"
        - "// DEPRECATED"
        - "# DEPRECATED"
        - "@deprecated"

# =============================================================================
# AUTO-MAPPING RULES - Link files to docs automatically
# Customize these patterns for your project structure
# =============================================================================
auto_mapping:
  enabled: true
  rules: []
  # EXAMPLES - define in project-config.yaml:
  # - file_pattern: "**/api/**"
  #   docs: ["API_ARCHITECTURE.md", "INVARIANTS.md#api"]
  # - file_pattern: "**/database/**"
  #   docs: ["DATABASE_ARCHITECTURE.md"]
  # - file_pattern: "**/auth/**"
  #   docs: ["INVARIANTS.md#security"]

# =============================================================================
# LOOP CLOSURE - Ensure all related files are updated
# File patterns use {{EXT}} placeholder - replaced at runtime based on language
# =============================================================================
loop_closure:
  enabled: true
  rules:
    - trigger: "code_change"
      file_pattern: "**/*.{{EXT}}"
      requires:
        - "CHANGELOG.md"  # Always
      conditional:
        - if: "tier_a"
          requires:
            - "INVARIANTS.md"
            - "linked_architecture_doc"
        - if: "bug_fix"
          requires:
            - "BUG_TRACKER.md"
            - "BUG_PATTERNS.md"

    - trigger: "new_file"
      requires:
        - "CODE_DOC_MAP.md"

    - trigger: "version_bump"
      requires:
        - "CHANGELOG.md"
        - "{{VERSION_FILE}}"  # Configured per language
        - "CLAUDE.md"

# =============================================================================
# DOC-SET DISCOVERY MODEL
# Enables per-subsystem documentation folders
# =============================================================================
doc_sets:
  # Marker file: folder containing this file IS a doc-set
  marker_file: "CODE_DOC_MAP.md"
  # Discovery path for doc-sets
  discovery_path: "docs/*/"

  # Expected siblings in each doc-set folder
  expected_files:
    - "INVARIANTS.md"       # Required for Tier A enforcement
    - "BUG_PATTERNS.md"     # Optional
    - "GOLDEN_PATHS.md"     # Optional
    - "DECISIONS/"          # Optional folder for ADRs (ADR-{id}-NNN.md)

  # Core design principles
  principles:
    # 1. CODE_DOC_MAP.md defines a doc-set (no config needed)
    # 2. Tier-A enforcement is map-driven (sibling INVARIANTS.md)
    # 3. One doc-set per file (no collisions, use global/ for shared)
    # 4. Repo-relative paths only (deterministic matching)
    # 5. Root CODE_DOC_MAP.md deprecated (fallback with warning)
    # 6. Unlisted files have no requirements

# =============================================================================
# LANGUAGE PLACEHOLDERS
# These are replaced based on core/languages/*.yaml or project-config.yaml
# =============================================================================
placeholders:
  EXT: "{{EXT}}"  # File extension (py, js, go, rs, java, cs)
  TEST_EXT: "{{TEST_EXT}}"  # Test file extension/pattern
  VERSION_FILE: "{{VERSION_FILE}}"  # Where version is defined
  MAIN_BRANCH: "{{MAIN_BRANCH}}"  # Usually "main" or "master"
  CODE_ROOT: "{{CODE_ROOT}}"  # Root directory for source code
